<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Carbon - Marketplace</title>
    <style>
        @import url(https://fonts.googleapis.com/css2?family=Lato&display=swap);
        @import url(https://fonts.googleapis.com/css2?family=Open+Sans&display=swap);
        @import url(https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined);
        /* Prevent initial flash before scripts initialize */
        #webcrumbs { visibility: hidden; }
    </style>
</head>
<body>
<div id="webcrumbs">
    <div class="min-h-screen bg-gradient-to-br from-[#ECFDF5] to-[#F0F9FF] font-sans">
        <!-- Sidebar -->
        <aside class="fixed top-0 left-0 z-10 h-full w-64 bg-white/80 backdrop-blur-md border-r border-slate-200 transition-all duration-300 transform lg:translate-x-0 -translate-x-full shadow-xl">
            <div class="p-4 border-b border-slate-200">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-r from-[#00C2A8] to-[#3B82F6] flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                    </div>
                    <h1 class="ml-3 font-bold text-slate-800 text-xl">Blue Carbon</h1>
                </div>
            </div>
            
            <nav class="p-4">
                <ul class="space-y-2">
                    <li><a href="dashboard.html" class="flex items-center p-2 rounded-lg text-slate-800 hover:bg-slate-100 transition-all group">
                        <span class="material-symbols-outlined mr-3 text-slate-600 group-hover:text-[#00C2A8]">dashboard</span>
                        <span>Dashboard</span>
                    </a></li>
                    <li><a href="#" class="flex items-center p-2 rounded-lg text-slate-800 hover:bg-slate-100 transition-all group">
                        <span class="material-symbols-outlined mr-3 text-slate-600 group-hover:text-[#00C2A8]">landscape</span>
                        <span>My Projects</span>
                    </a></li>
                    <li><a href="verifier-dashboard.html" class="flex items-center p-2 rounded-lg text-slate-800 hover:bg-slate-100 transition-all group">
                        <span class="material-symbols-outlined mr-3 text-slate-600 group-hover:text-[#00C2A8]">verified</span>
                        <span>Verification</span>
                    </a></li>
                    <li><a href="#" class="flex items-center p-2 rounded-lg text-slate-800 hover:bg-slate-100 transition-all group">
                        <span class="material-symbols-outlined mr-3 text-slate-600 group-hover:text-[#00C2A8]">analytics</span>
                        <span>MRV & Analytics</span>
                    </a></li>
                    <li><a href="#" class="flex items-center p-2 rounded-lg bg-[#ECFDF5] text-[#00C2A8] transition-all group">
                        <span class="material-symbols-outlined mr-3">shopping_cart</span>
                        <span>Marketplace</span>
                    </a></li>
                    <li><a href="app.html#/settings" class="flex items-center p-2 rounded-lg text-slate-800 hover:bg-slate-100 transition-all group">
                        <span class="material-symbols-outlined mr-3 text-slate-600 group-hover:text-[#00C2A8]">settings</span>
                        <span>Settings</span>
                    </a></li>
                    <li><a href="app.html#/support" class="flex items-center p-2 rounded-lg text-slate-800 hover:bg-slate-100 transition-all group">
                        <span class="material-symbols-outlined mr-3 text-slate-600 group-hover:text-[#00C2A8]">help</span>
                        <span>Support</span>
                    </a></li>
                </ul>
            </nav>
            
            <div class="absolute bottom-0 left-0 right-0 p-4">
                <div class="flex items-center p-3 rounded-xl bg-gradient-to-r from-[#ECFDF5] to-[#EFF6FF]">
                    <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center shadow-sm">
                        <span class="material-symbols-outlined text-[#00C2A8]">person</span>
                    </div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-slate-800">Alex Thompson</p>
                        <p class="text-xs text-slate-500">Project Developer</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="lg:pl-64 pt-4 lg:pt-0 pb-20">
            <!-- Header -->
            <header class="hidden lg:block sticky top-0 bg-white/80 backdrop-blur-md border-b border-slate-200 px-8 py-4 z-10">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800">Carbon Credit Marketplace</h2>
                        <p class="text-slate-600 mt-1">Browse and purchase verified carbon credits from projects around the world</p>
                    </div>
                    <div class="flex items-center">
                        <button class="p-2 rounded-full hover:bg-slate-100 mr-2">
                            <span class="material-symbols-outlined">notifications</span>
                        </button>
                        <div class="h-8 w-8 rounded-full bg-gradient-to-r from-[#00C2A8] to-[#3B82F6] flex items-center justify-center text-white text-sm font-bold">AT</div>
                    </div>
                </div>
            </header>

            <div class="px-4 md:px-8 py-6">
                <!-- Search and Filters -->
                <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-3 top-2 text-slate-400">search</span>
                            <input type="text" placeholder="Search projects or regions..." class="pl-10 pr-4 py-2 w-full rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50 focus:border-[#00C2A8] text-sm" id="searchInput">
                        </div>
                        <select class="px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50 text-sm" id="ecosystemFilter">
                            <option value="">All Ecosystems</option>
                            <option value="mangrove">Mangrove</option>
                            <option value="seagrass">Seagrass</option>
                            <option value="saltmarsh">Salt Marsh</option>
                            <option value="wetland">Wetland</option>
                            <option value="peatland">Peatland</option>
                        </select>
                        <select class="px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50 text-sm" id="regionFilter">
                            <option value="">All Regions</option>
                            <option value="asia">Asia</option>
                            <option value="americas">Americas</option>
                            <option value="europe">Europe</option>
                            <option value="africa">Africa</option>
                            <option value="oceania">Oceania</option>
                        </select>
                        <select class="px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50 text-sm" id="priceFilter">
                            <option value="">All Prices</option>
                            <option value="0-20">₹0 - ₹20</option>
                            <option value="20-50">₹20 - ₹50</option>
                            <option value="50-100">₹50 - ₹100</option>
                            <option value="100+">₹100+</option>
                        </select>
                        <select class="px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50 text-sm" id="statusFilter">
                            <option value="">All Status</option>
                            <option value="verified">Verified</option>
                            <option value="pending">Pending</option>
                        </select>
                    </div>
                </div>

                <!-- Projects Grid -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-slate-800">Available Projects</h3>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm text-slate-600">Showing <span id="projectCount">12</span> projects</span>
                            <button class="p-2 rounded-lg hover:bg-slate-100 text-slate-600">
                                <span class="material-symbols-outlined">view_module</span>
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="projectsGrid">
                        <!-- Project cards will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Analytics Widget -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Monthly Credits Sold</h3>
                        <div class="h-48 w-full">
                            <div class="h-full w-full bg-gradient-to-b from-[#ECFDF5]/30 to-transparent rounded-lg flex items-end relative">
                                <div class="absolute top-0 left-0 right-0 h-[1px] bg-[#00C2A8]/20"></div>
                                <div class="absolute top-1/4 left-0 right-0 h-[1px] bg-[#00C2A8]/20"></div>
                                <div class="absolute top-1/2 left-0 right-0 h-[1px] bg-[#00C2A8]/20"></div>
                                <div class="absolute top-3/4 left-0 right-0 h-[1px] bg-[#00C2A8]/20"></div>
                                <div class="w-1/12 h-[25%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[40%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[35%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[55%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[45%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[65%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[60%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[42%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[68%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[80%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[75%] bg-[#00C2A8]/70 rounded-t"></div>
                                <div class="w-1/12 h-[85%] bg-[#00C2A8]/70 rounded-t"></div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Average Price per Credit</h3>
                        <div class="text-center">
                            <p class="text-4xl font-bold text-[#00C2A8] mb-2">₹28.50</p>
                            <p class="text-sm text-slate-600">+5.2% from last month</p>
                        </div>
                        <div class="mt-6 space-y-3">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Mangrove</span>
                                <span class="text-sm font-medium text-slate-800">₹25.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Seagrass</span>
                                <span class="text-sm font-medium text-slate-800">₹30.00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-slate-600">Salt Marsh</span>
                                <span class="text-sm font-medium text-slate-800">₹28.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-sm border border-slate-200">
                        <h3 class="text-lg font-semibold text-slate-800 mb-4">Top-Selling Ecosystems</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full bg-[#16A34A] mr-3"></div>
                                    <span class="text-sm text-slate-600">Mangrove</span>
                                </div>
                                <span class="text-sm font-medium text-slate-800">45%</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full bg-[#3B82F6] mr-3"></div>
                                    <span class="text-sm text-slate-600">Seagrass</span>
                                </div>
                                <span class="text-sm font-medium text-slate-800">30%</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full bg-[#00C2A8] mr-3"></div>
                                    <span class="text-sm text-slate-600">Salt Marsh</span>
                                </div>
                                <span class="text-sm font-medium text-slate-800">15%</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full bg-[#FF7EB3] mr-3"></div>
                                    <span class="text-sm text-slate-600">Wetland</span>
                                </div>
                                <span class="text-sm font-medium text-slate-800">10%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Purchases -->
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold text-slate-800">Recent Purchases</h3>
                        <button class="px-4 py-2 bg-slate-100 text-slate-700 font-medium rounded-lg hover:bg-slate-200 transition-all flex items-center">
                            <span class="material-symbols-outlined mr-2">download</span>
                            Export
                        </button>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-slate-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Project Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Credits Purchased</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Total Paid</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Date</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200 bg-white" id="recentPurchasesTable">
                                <!-- Recent purchases will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Project Details Modal -->
<div id="projectModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-semibold text-slate-800">Project Details</h3>
                <button onclick="closeProjectModal()" class="p-2 rounded-lg hover:bg-slate-100">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div id="projectDetails">
                <!-- Project details will be populated by JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Purchase Modal -->
<div id="purchaseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-lg font-semibold text-slate-800">Purchase Carbon Credits</h3>
                <button onclick="closePurchaseModal()" class="p-2 rounded-lg hover:bg-slate-100">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>

            <!-- Step 1: Select Credits -->
            <div id="step1" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Number of Credits</label>
                    <input type="number" id="creditAmount" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50" placeholder="Enter number of credits" min="1">
                </div>
                <div class="p-4 bg-slate-50 rounded-lg">
                    <p class="text-sm text-slate-600">Price per credit: <span id="creditPrice">₹25.00</span></p>
                    <p class="text-lg font-semibold text-slate-800 mt-2">Total: <span id="totalPrice">₹0.00</span></p>
                </div>
                <button onclick="nextStep()" class="w-full px-4 py-2 bg-[#00C2A8] text-white rounded-lg hover:bg-[#00A896] transition-colors">
                    Continue to Payment
                </button>
            </div>

            <!-- Step 2: Payment Info -->
            <div id="step2" class="space-y-4 hidden">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Full Name</label>
                    <input type="text" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50" placeholder="John Doe">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Email</label>
                    <input type="email" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50" placeholder="john@example.com">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">Card Number</label>
                    <input type="text" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50" placeholder="1234 5678 9012 3456">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Expiry Date</label>
                        <input type="text" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50" placeholder="MM/YY">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">CVV</label>
                        <input type="text" class="w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#00C2A8]/50" placeholder="123">
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button onclick="prevStep()" class="flex-1 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors">
                        Back
                    </button>
                    <button onclick="nextStep()" class="flex-1 px-4 py-2 bg-[#00C2A8] text-white rounded-lg hover:bg-[#00A896] transition-colors">
                        Continue
                    </button>
                </div>
            </div>

            <!-- Step 3: Confirmation -->
            <div id="step3" class="space-y-4 hidden">
                <div class="p-4 bg-green-50 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">Purchase Summary</h4>
                    <p class="text-sm text-green-700">Project: <span id="confirmProject">Sundarbans Mangrove</span></p>
                    <p class="text-sm text-green-700">Credits: <span id="confirmCredits">0</span></p>
                    <p class="text-sm text-green-700">Total: <span id="confirmTotal">₹0.00</span></p>
                </div>
                <div class="flex space-x-3">
                    <button onclick="prevStep()" class="flex-1 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors">
                        Back
                    </button>
                    <button onclick="confirmPurchase()" class="flex-1 px-4 py-2 bg-[#16A34A] text-white rounded-lg hover:bg-[#15803D] transition-colors">
                        Confirm Purchase
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.tailwindcss.com"></script>
<script>
    // Mock data
    const mockProjects = [
        {
            id: 1,
            name: "Sundarbans Mangrove Restoration",
            ecosystem: "Mangrove",
            location: "West Bengal, India",
            availableCredits: 50000,
            pricePerCredit: 25.00,
            status: "Verified",
            description: "Large-scale mangrove restoration project in the Sundarbans region focusing on carbon sequestration and biodiversity conservation.",
            co2Sequestered: 125000,
            biodiversityImpact: "High",
            communityBenefits: "Employment for 500+ local families",
            verificationDate: "2025-01-15"
        },
        {
            id: 2,
            name: "Gulf of Mannar Seagrass",
            ecosystem: "Seagrass",
            location: "Tamil Nadu, India",
            availableCredits: 30000,
            pricePerCredit: 30.00,
            status: "Verified",
            description: "Seagrass restoration project in the Great Barrier Reef region to enhance carbon storage and marine biodiversity.",
            co2Sequestered: 90000,
            biodiversityImpact: "Very High",
            communityBenefits: "Marine tourism support",
            verificationDate: "2025-01-10"
        },
        {
            id: 3,
            name: "Florida Wetlands Conservation",
            ecosystem: "Wetland",
            location: "Odisha, India",
            availableCredits: 25000,
            pricePerCredit: 22.00,
            status: "Verified",
            description: "Wetland conservation and restoration project in Florida to protect coastal ecosystems and sequester carbon.",
            co2Sequestered: 55000,
            biodiversityImpact: "High",
            communityBenefits: "Flood protection for local communities",
            verificationDate: "2025-01-05"
        },
        {
            id: 4,
            name: "Indonesian Peatland Protection",
            ecosystem: "Peatland",
            location: "Andaman & Nicobar, India",
            availableCredits: 40000,
            pricePerCredit: 35.00,
            status: "Pending",
            description: "Peatland protection project in Indonesia to prevent carbon emissions and preserve unique ecosystems.",
            co2Sequestered: 140000,
            biodiversityImpact: "Very High",
            communityBenefits: "Sustainable agriculture support",
            verificationDate: "Pending"
        }
    ];

    const mockRecentPurchases = [
        {
            projectName: "Sundarbans Mangrove Restoration",
            creditsPurchased: 100,
            totalPaid: 2500.00,
            date: "2025-01-20",
            status: "Completed"
        },
        {
            projectName: "Great Barrier Seagrass",
            creditsPurchased: 50,
            totalPaid: 1500.00,
            date: "2025-01-18",
            status: "Completed"
        },
        {
            projectName: "Florida Wetlands Conservation",
            creditsPurchased: 75,
            totalPaid: 1650.00,
            date: "2025-01-15",
            status: "Completed"
        }
    ];

    const PURCHASES_KEY = 'purchaseHistory';

    function getStoredPurchases() {
        try { return JSON.parse(localStorage.getItem(PURCHASES_KEY) || '[]'); } catch { return []; }
    }
    function saveStoredPurchases(arr) {
        localStorage.setItem(PURCHASES_KEY, JSON.stringify(arr));
    }

    let currentStep = 1;
    let selectedProject = null;

    // Initialize marketplace
    document.addEventListener('DOMContentLoaded', function() {
        const isLoggedIn = localStorage.getItem('userLoggedIn');
        if (!isLoggedIn) {
            window.location.href = 'login.html';
            return;
        }

        populateProjectsGrid();
        populateRecentPurchases();
        setupEventListeners();

        // Reveal UI after initialization completes
        const appRoot = document.getElementById('webcrumbs');
        if (appRoot) appRoot.style.visibility = 'visible';
    });

    function populateProjectsGrid() {
        const grid = document.getElementById('projectsGrid');
        grid.innerHTML = '';

        mockProjects.forEach(project => {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-xl p-6 shadow-sm border border-slate-200 hover:shadow-md transition-shadow';
            card.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-lg bg-[#ECFDF5] flex items-center justify-center text-[#16A34A] mr-3">
                            <span class="material-symbols-outlined">landscape</span>
                        </div>
                        <div>
                            <h4 class="font-semibold text-slate-800 text-sm">${project.name}</h4>
                            <p class="text-xs text-slate-500">ID: BCRA-${project.id.toString().padStart(4, '0')}</p>
                        </div>
                    </div>
                    <span class="px-2 py-1 text-xs font-medium rounded-full ${project.status === 'Verified' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${project.status}</span>
                </div>
                
                <div class="space-y-2 mb-4">
                    <div class="flex items-center text-sm text-slate-600">
                        <span class="material-symbols-outlined text-xs mr-2">landscape</span>
                        <span>${project.ecosystem}</span>
                    </div>
                    <div class="flex items-center text-sm text-slate-600">
                        <span class="material-symbols-outlined text-xs mr-2">location_on</span>
                        <span>${project.location}</span>
                    </div>
                    <div class="flex items-center text-sm text-slate-600">
                        <span class="material-symbols-outlined text-xs mr-2">inventory</span>
                        <span>${project.availableCredits.toLocaleString()} credits</span>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-4">
                    <div>
                        <p class="text-2xl font-bold text-slate-800">₹${project.pricePerCredit.toFixed(2)}</p>
                        <p class="text-xs text-slate-500">per credit</p>
                    </div>
                </div>

                <div class="flex space-x-2">
                    <button onclick="viewProject(${project.id})" class="flex-1 px-3 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors text-sm">
                        View Details
                    </button>
                    <button onclick="purchaseCredits(${project.id})" class="flex-1 px-3 py-2 bg-[#00C2A8] text-white rounded-lg hover:bg-[#00A896] transition-colors text-sm">
                        Purchase
                    </button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    function populateRecentPurchases() {
        const tbody = document.getElementById('recentPurchasesTable');
        tbody.innerHTML = '';

        const stored = getStoredPurchases();
        const combined = [...stored, ...mockRecentPurchases];

        combined.forEach(purchase => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-slate-50 transition-colors';
            row.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">${purchase.projectName}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${purchase.creditsPurchased}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">₹${Number(purchase.totalPaid||0).toFixed(2)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${purchase.date}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">${purchase.status || 'Completed'}</span>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    function setupEventListeners() {
        // Search and filter functionality
        document.getElementById('searchInput').addEventListener('input', filterProjects);
        document.getElementById('ecosystemFilter').addEventListener('change', filterProjects);
        document.getElementById('regionFilter').addEventListener('change', filterProjects);
        document.getElementById('priceFilter').addEventListener('change', filterProjects);
        document.getElementById('statusFilter').addEventListener('change', filterProjects);

        // Credit amount calculation
        document.getElementById('creditAmount').addEventListener('input', calculateTotal);
    }

    function filterProjects() {
        // Mock filtering logic - in a real app, this would filter the projects array
        console.log('Filtering projects...');
        // For now, we'll just update the count
        document.getElementById('projectCount').textContent = mockProjects.length;
    }

    function viewProject(projectId) {
        const project = mockProjects.find(p => p.id === projectId);
        if (project) {
            document.getElementById('projectDetails').innerHTML = `
                <div class="space-y-6">
                    <div class="flex items-start justify-between">
                        <div>
                            <h4 class="text-xl font-bold text-slate-800 mb-2">${project.name}</h4>
                            <p class="text-slate-600">${project.description}</p>
                        </div>
                        <span class="px-3 py-1 text-sm font-medium rounded-full ${project.status === 'Verified' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">${project.status}</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div>
                                <h5 class="font-semibold text-slate-800 mb-2">Project Information</h5>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Ecosystem</span>
                                        <span class="text-sm font-medium text-slate-800">${project.ecosystem}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Location</span>
                                        <span class="text-sm font-medium text-slate-800">${project.location}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Available Credits</span>
                                        <span class="text-sm font-medium text-slate-800">${project.availableCredits.toLocaleString()}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Price per Credit</span>
                                        <span class="text-sm font-medium text-slate-800">₹${project.pricePerCredit.toFixed(2)}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Verification Date</span>
                                        <span class="text-sm font-medium text-slate-800">${project.verificationDate}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <h5 class="font-semibold text-slate-800 mb-2">Impact Metrics</h5>
                                <div class="space-y-2">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">CO₂ Sequestered</span>
                                        <span class="text-sm font-medium text-slate-800">${project.co2Sequestered.toLocaleString()} tons</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Biodiversity Impact</span>
                                        <span class="text-sm font-medium text-slate-800">${project.biodiversityImpact}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-slate-600">Community Benefits</span>
                                        <span class="text-sm font-medium text-slate-800">${project.communityBenefits}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button class="px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors flex items-center">
                            <span class="material-symbols-outlined mr-2">download</span>
                            Download Documents
                        </button>
                        <button onclick="purchaseCredits(${project.id})" class="px-4 py-2 bg-[#00C2A8] text-white rounded-lg hover:bg-[#00A896] transition-colors flex items-center">
                            <span class="material-symbols-outlined mr-2">shopping_cart</span>
                            Purchase Credits
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('projectModal').classList.remove('hidden');
        }
    }

    function purchaseCredits(projectId) {
        selectedProject = mockProjects.find(p => p.id === projectId);
        if (selectedProject) {
            document.getElementById('creditPrice').textContent = `₹${selectedProject.pricePerCredit.toFixed(2)}`;
            document.getElementById('confirmProject').textContent = selectedProject.name;
            currentStep = 1;
            showStep(1);
            document.getElementById('purchaseModal').classList.remove('hidden');
        }
    }

    function calculateTotal() {
        const amount = parseInt(document.getElementById('creditAmount').value) || 0;
        const price = selectedProject ? selectedProject.pricePerCredit : 0;
        const total = amount * price;
        document.getElementById('totalPrice').textContent = `₹${total.toFixed(2)}`;
        document.getElementById('confirmCredits').textContent = amount;
        document.getElementById('confirmTotal').textContent = `₹${total.toFixed(2)}`;
    }

    function nextStep() {
        if (currentStep < 3) {
            currentStep++;
            showStep(currentStep);
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            currentStep--;
            showStep(currentStep);
        }
    }

    function showStep(step) {
        document.getElementById('step1').classList.toggle('hidden', step !== 1);
        document.getElementById('step2').classList.toggle('hidden', step !== 2);
        document.getElementById('step3').classList.toggle('hidden', step !== 3);
    }

    function confirmPurchase() {
        // Mock purchase confirmation
        const amount = parseInt(document.getElementById('creditAmount').value) || 0;
        const price = selectedProject ? selectedProject.pricePerCredit : 0;
        const total = amount * price;
        const record = {
            projectName: selectedProject ? selectedProject.name : 'Unknown Project',
            creditsPurchased: amount,
            totalPaid: total,
            date: new Date().toISOString().slice(0,10),
            status: 'Completed'
        };
        const stored = getStoredPurchases();
        stored.unshift(record);
        saveStoredPurchases(stored);
        localStorage.setItem('purchaseJustMade', record.projectName);
        populateRecentPurchases();
        alert('Purchase completed successfully! Your carbon credits have been added to your portfolio.');
        closePurchaseModal();
    }

    function closePurchaseModal() {
        document.getElementById('purchaseModal').classList.add('hidden');
        currentStep = 1;
        showStep(1);
    }

    function closeProjectModal() {
        document.getElementById('projectModal').classList.add('hidden');
    }

    // Tailwind config
    tailwind.config = {
        content: ["./src/**/*.{html,js}"],
        theme: {
            extend: {
                colors: {
                    primary: {
                        50: '#f0f9ff',
                        500: '#00C2A8',
                        600: '#3B82F6'
                    }
                }
            }
        }
    };
</script>
</body>
</html>
